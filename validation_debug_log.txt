/Users/mar/MIT Dropbox/Marielle Russo/2025_workspace/PrxteinMPNN/.venv/lib/python3.13/site-packages/jax/_src/numpy/reductions.py:232: UserWarning: Explicitly requested dtype <class 'jax.numpy.float64'> requested in sum is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return _reduction(a, "sum", lax.add, 0, preproc=_cast_to_numeric,
/Users/mar/MIT Dropbox/Marielle Russo/2025_workspace/PrxteinMPNN/.venv/lib/python3.13/site-packages/jax/_src/numpy/reductions.py:165: UserWarning: Explicitly requested dtype <class 'jax.numpy.float64'> requested in convert_element_type is not available, and will be truncated to dtype float32. To enable more dtypes, set the jax_enable_x64 configuration option or the JAX_ENABLE_X64 shell environment variable. See https://github.com/jax-ml/jax#current-gotchas for more.
  return lax.convert_element_type(result, dtype or result_dtype)
===========================================================
   JAX MD vs OpenMM Validation: 1UAO + ff19SB + OBC2
===========================================================

[1] Setting up OpenMM System...
Warning: Using amber14-all.xml. If JAX uses ff19SB, parameters might differ slightly.
OpenMM Total Energy: -248.2369 kcal/mol

[2] Setting up JAX MD System...

[DEBUG] Top 10 Closest Pairs:
  1. 0.9600 A: 97 (OG1) - 102 (HG1)
  2. 0.9600 A: 102 (HG1) - 97 (OG1)
  3. 0.9600 A: 76 (OG1) - 81 (HG1)
  4. 0.9600 A: 81 (HG1) - 76 (OG1)
  5. 0.9601 A: 20 (OH) - 29 (HH)
  6. 0.9601 A: 29 (HH) - 20 (OH)
  7. 0.9762 A: 106 (N) - 120 (H)
  8. 0.9762 A: 120 (H) - 106 (N)
  9. 0.9788 A: 114 (NE1) - 125 (HE1)
  10. 0.9788 A: 125 (HE1) - 114 (NE1)
DEBUG: Using provided gb_radii. Stats: Min=1.2000000476837158, Max=1.7000000476837158
DEBUG: compute_gb_energy called with mask!
DEBUG: Born Radii Min=0.5578517317771912, Max=1.547054409980774, Mean=0.9133179187774658
DEBUG: Components: Bond=27.177154541015625, Angle=8.71909236907959, Dihedral=121.5749282836914, Improper=0.00038515147753059864, CMAP=0.0, LJ=3048661.25, Elec=-2602.333984375, NP=0.0
DEBUG: Using provided gb_radii. Stats: Min=1.2000000476837158, Max=1.7000000476837158
DEBUG: compute_gb_energy called with mask!
DEBUG: Born Radii Min=LinearizeTracer<float32[]>, Max=LinearizeTracer<float32[]>, Mean=LinearizeTracer<float32[]>
DEBUG: Components: Bond=LinearizeTracer<float32[]>, Angle=LinearizeTracer<float32[]>, Dihedral=LinearizeTracer<float32[]>, Improper=LinearizeTracer<float32[]>, CMAP=0.0, LJ=LinearizeTracer<float32[]>, Elec=LinearizeTracer<float32[]>, NP=LinearizeTracer<float32[]>
JAX MD Total Energy: 3046216.5000 kcal/mol

[Stage 1] Parameter Validation
Max Charge Diff: 0.785500 (Tol: 1e-4)
Max Sigma Diff:  2.430922 (Tol: 1e-4)
Max Epsilon Diff:0.110000 (Tol: 1e-4)
FAIL: Parameters mismatch.
Max Charge Diff at atom 134 (OXT): -0.7855 vs 0.0

[DEBUG] Overwriting JAX parameters with OpenMM parameters for Energy/Force check...
OpenMM Forces:
 - HarmonicBondForce
 - PeriodicTorsionForce
 - NonbondedForce
 - HarmonicAngleForce
 - CustomGBForce
   CustomGBForce Parameters: 3
    - charge
    - or
    - sr
DEBUG: GB Radii Stats: Min=1.1100, Max=1.6100, Mean=1.3596
DEBUG: Extracted 141 bonds from OpenMM.
DEBUG: Bond (97, 102) found in OpenMM bonds: True
DEBUG: Using provided gb_radii. Stats: Min=1.1100000143051147, Max=1.6100000143051147
DEBUG: Components: Bond=20.41362953186035, Angle=7.9836201667785645, Dihedral=174.75238037109375, Improper=0.0, CMAP=0.0, LJ=54.68016052246094, Elec=-57.787925720214844, NP=0.0
DEBUG: Vacuum Energy (No GBSA): 200.0418 kcal/mol
Recalculating JAX Energy and Forces with Injected Parameters...
DEBUG: Using provided gb_radii. Stats: Min=1.1100000143051147, Max=1.6100000143051147
DEBUG: compute_gb_energy called with mask!
DEBUG: Born Radii Min=0.9561324715614319, Max=1.676517367362976, Mean=1.2933238744735718
DEBUG: Components: Bond=20.41362953186035, Angle=7.9836201667785645, Dihedral=174.75238037109375, Improper=0.0, CMAP=0.0, LJ=54.68016052246094, Elec=-2188.12255859375, NP=0.0
DEBUG: Using provided gb_radii. Stats: Min=1.1100000143051147, Max=1.6100000143051147
DEBUG: compute_gb_energy called with mask!
DEBUG: Born Radii Min=LinearizeTracer<float32[]>, Max=LinearizeTracer<float32[]>, Mean=LinearizeTracer<float32[]>
DEBUG: Components: Bond=LinearizeTracer<float32[]>, Angle=LinearizeTracer<float32[]>, Dihedral=LinearizeTracer<float32[]>, Improper=0.0, CMAP=0.0, LJ=LinearizeTracer<float32[]>, Elec=LinearizeTracer<float32[]>, NP=LinearizeTracer<float32[]>
JAX MD Total Energy (Recalculated): -1930.2927 kcal/mol

[Stage 2] Energy Component Validation
Component            | OpenMM (kcal/mol)    | JAX (kcal/mol)       | Diff       | Status
-------------------------------------------------------------------------------------
Bond                 |              20.4136 |              20.4136 |    -0.0000 | PASS

[Deep Debug] Torsion & GBSA
Traceback (most recent call last):
  File "/Users/mar/MIT Dropbox/Marielle Russo/2025_workspace/PrxteinMPNN/scripts/debug_md/validate_1uao_ff19sb.py", line 811, in <module>
    run_validation()
    ~~~~~~~~~~~~~~^^
  File "/Users/mar/MIT Dropbox/Marielle Russo/2025_workspace/PrxteinMPNN/scripts/debug_md/validate_1uao_ff19sb.py", line 552, in run_validation
    print_row("Bond", omm_bond, e_bond_jax)
    ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mar/MIT Dropbox/Marielle Russo/2025_workspace/PrxteinMPNN/scripts/debug_md/validate_1uao_ff19sb.py", line 722, in print_row
    idx = sorted_idx[0] # Worst one
          ^^^^^^^^^^
NameError: name 'sorted_idx' is not defined
